name: Claude Code Version Monitor

on:
  schedule:
    # 毎日 JST 09:00〜19:00 に1時間ごと（UTC 00:00〜10:00）
    - cron: '0 0-10 * * *'
  workflow_dispatch:
    # 手動実行も可能

permissions:
  contents: write

jobs:
  check-version:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Check for Claude Code updates
        env:
          GCHAT_WEBHOOK_URL: ${{ secrets.GCHAT_WEBHOOK_URL }}
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
          GCHAT_THREAD_NAME: ${{ secrets.GCHAT_THREAD_NAME }}
        run: bash scripts/check-update.sh

      # NOTE: テスト中のため一時的にコメントアウト
      # - name: Commit version update
      #   run: |
      #     git config user.name "github-actions[bot]"
      #     git config user.email "github-actions[bot]@users.noreply.github.com"
      #     if git diff --quiet last-version.txt 2>/dev/null; then
      #       echo "No version change. Nothing to commit."
      #     else
      #       git add last-version.txt
      #       git commit -m "chore: update last-version to $(cat last-version.txt)"
      #       git push
      #     fi
